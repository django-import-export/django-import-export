participant Resource
participant Result
participant RowResult
participant InstanceLoader
participant Field

Resource->Resource:""import_data()""
activate Resource
Resource->Result:""__init__()""
activate Result
Resource<--Result:""Result""
deactivate Result

Resource->Resource:<background:#yellow>""before_import()""

loop #pink each row in dataset
Resource->Resource:""import_row()""
activate Resource #lightblue
Resource->RowResult:""__init__()""
activate RowResult
Resource<--RowResult:""RowResult""
deactivate RowResult

Resource->Resource:<background:#yellow>""before_import_row()""


Resource->Resource:<background:#yellow>""get_or_init_instance()""
activate Resource #lightgrey

Resource->Resource:<background:#yellow>""get_instance()""
activate Resource #lightgreen
Resource->InstanceLoader:""get_instance()""
activate InstanceLoader
note over InstanceLoader: Existing Instance is returned if exists,\n otherwise a new Instance is created.

Resource<--InstanceLoader:""Instance""
Resource-->Resource:""Instance""
deactivate Resource
deactivate InstanceLoader
Resource-->Resource:""Instance, bool""
deactivate Resource



Resource->Resource:<background:#yellow>""after_init_instance()""


Resource->Resource:<background:#yellow>""for_delete()""
activate Resource #lightgrey
note over Resource: If True, row is deleted.
Resource-->Resource:""bool""

deactivate Resource


Resource->Resource:""import_instance()""
activate Resource #lightgrey

loop #green each field in row
Resource->Field:save()
end
space
deactivate Resource

Resource->Resource:<background:#yellow>""skip_row()""
activate Resource #lightgrey
note over Resource: If True, row is skipped.
Resource-->Resource:""bool""
deactivate Resource

Resource->Resource:<background:#yellow>""validate_instance()""
Resource->Resource:<background:#yellow>""save_instance()""
Resource->Resource:<background:#yellow>""save_m2m()""

Resource->Resource:<background:#yellow>""after_import_row()""


Resource-->Resource:""RowResult""
deactivate Resource
end

Resource<--Resource:""Result""
deactivate Resource
